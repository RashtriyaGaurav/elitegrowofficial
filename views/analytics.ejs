<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Analytics | EliteGrow</title>

  <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>

  <style>
    @import url('https://fonts.googleapis.com/css2?family=Google+Sans+Code:wght@400;700&display=swap');

    body::-webkit-scrollbar {
      display: none;
    }

    /* #Dashboard{
      flex-wrap: wrap;
    } */
  </style>
</head>

<body class="bg-zinc-900 text-white">
  <div class="flex">
    <!-- Sidebar -->
    <div class="min-h-screen w-[20vw] bg-black/30 p-4 hidden md:block">
      <a style="font-family: 'Google Sans Code';" href="/" class="text-2xl block mb-6">
        Elite<span class="text-blue-500">Grow</span>
      </a>
      <nav class="flex flex-col gap-1">
        <button onclick="showSection('Dashboard')"
          class="hover:bg-zinc-800 px-3 py-1 rounded-md text-left text-xl transition duration-200">Dashboard</button>
        <button onclick="showSection('users')"
          class="hover:bg-zinc-800 px-3 py-1 rounded-md text-left text-xl transition duration-200">Users</button>
        <button onclick="showSection('assets')"
          class="hover:bg-zinc-800 px-3 py-1 rounded-md text-left text-xl transition duration-200">Assets</button>
        <button onclick="showSection('messages')"
          class="hover:bg-zinc-800 px-3 py-1 rounded-md text-left text-xl transition duration-200">Messages</button>
      </nav>
    </div>

    <!-- Main Content -->
    <div class="min-h-screen md:w-[80vw] w-full p-5">

      <!-- Dashboard -->
      <div id="Dashboard"
        class="section gap-5 flex md:flex-nowrap flex-wrap opacity-0 scale-95 transition duration-300">

        <div class="w-[60%] w-full rounded-2xl flex gap-4 flex-col">
          <div class=" w-full rounded-2xl flex gap-4">
            <!-- Total Users -->
            <div class=" w-[50%] bg-zinc-800 rounded-2xl p-5 flex items-start flex-col justify-end">
              <div class="bg-green-600/30 p-3 rounded-xl mb-2">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                  stroke="currentColor" class="size-6">
                  <path stroke-linecap="round" stroke-linejoin="round"
                    d="M18 18.72a9.094 9.094 0 0 0 3.741-.479 3 3 0 0 0-4.682-2.72m.94 3.198.001.031c0 .225-.012.447-.037.666A11.944 11.944 0 0 1 12 21c-2.17 0-4.207-.576-5.963-1.584A6.062 6.062 0 0 1 6 18.719m12 0a5.971 5.971 0 0 0-.941-3.197m0 0A5.995 5.995 0 0 0 12 12.75a5.995 5.995 0 0 0-5.058 2.772m0 0a3 3 0 0 0-4.681 2.72 8.986 8.986 0 0 0 3.74.477m.94-3.197a5.971 5.971 0 0 0-.94 3.197M15 6.75a3 3 0 1 1-6 0 3 3 0 0 1 6 0Zm6 3a2.25 2.25 0 1 1-4.5 0 2.25 2.25 0 0 1 4.5 0Zm-13.5 0a2.25 2.25 0 1 1-4.5 0 2.25 2.25 0 0 1 4.5 0Z" />
                </svg>

              </div>
              <h1 class="text-zinc-200">Total Users</h1>
              <h1 class="text-zinc-100 font-semibold text-2xl">
                <%=totalUsers %>
              </h1>
            </div>

            <!-- Total Clicks -->
            <div class=" w-[50%] bg-zinc-800 rounded-2xl p-5 flex items-start flex-col justify-end">
              <div class="bg-green-600/30 p-3 rounded-xl mb-2">
                <svg xmlns="http://www.w3.org/2000/svg" class="size-6" fill="none" viewBox="0 0 24 24"
                  stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
                    d="M2.25 18 9 11.25l4.306 4.306a11.95 11.95 0 0 1 5.814-5.518" />
                </svg>
              </div>
              <h1 class="text-zinc-200">Total Clicks</h1>
              <h1 class="text-zinc-100 font-semibold text-2xl">
                <%= totalClicks %>
              </h1>
            </div>
          </div>
          <div class=" bg-green-800 w-full bg-zinc-800 rounded-2xl p-5 flex items-start flex-col justify-end">
            <div class="bg-green-600/30 p-3 rounded-xl mb-2">
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                stroke="currentColor" class="size-6">
                <path stroke-linecap="round" stroke-linejoin="round"
                  d="M18 18.72a9.094 9.094 0 0 0 3.741-.479 3 3 0 0 0-4.682-2.72m.94 3.198.001.031c0 .225-.012.447-.037.666A11.944 11.944 0 0 1 12 21c-2.17 0-4.207-.576-5.963-1.584A6.062 6.062 0 0 1 6 18.719m12 0a5.971 5.971 0 0 0-.941-3.197m0 0A5.995 5.995 0 0 0 12 12.75a5.995 5.995 0 0 0-5.058 2.772m0 0a3 3 0 0 0-4.681 2.72 8.986 8.986 0 0 0 3.74.477m.94-3.197a5.971 5.971 0 0 0-.94 3.197M15 6.75a3 3 0 1 1-6 0 3 3 0 0 1 6 0Zm6 3a2.25 2.25 0 1 1-4.5 0 2.25 2.25 0 0 1 4.5 0Zm-13.5 0a2.25 2.25 0 1 1-4.5 0 2.25 2.25 0 0 1 4.5 0Z" />
              </svg>

            </div>
            <h1 class="text-zinc-200">Total Users</h1>
            <h1 class="text-zinc-100 font-semibold text-2xl">
              <%=totalUsers %>
            </h1>
          </div>
        </div>

        <!-- Live Users Chart -->
        <div class="md:w-[40%] w-full bg-zinc-800 rounded-2xl p-5 flex flex-col justify-between">
          <div class="w-fit h-fit">
            <h2 class="text-zinc-200">Live Users Trend</h2>
            <h1 id="activeUserCount" class="text-zinc-100 font-semibold text-2xl mb-2">0</h1>
          </div>
          <div class="w-full h-full bg-red-500/0">
            <canvas id="activeUsersChart" class="w-full h-full"></canvas>
          </div>
        </div>
      </div>

      <!-- users -->
      <div id="users" class="section hidden opacity-0 scale-95 transition duration-300">
        <div class="relative overflow-x-auto sm:rounded-md">
          <table class="w-full text-sm text-left rtl:text-right  text-zinc-200">
            <thead class="text-xs uppercase bg-green-600/40 text-zinc-200">
              <tr>
                <th scope="col" class="px-6 py-3">Name</th>
                <th scope="col" class="px-6 py-3">Email</th>
                <th scope="col" class="px-6 py-3">Role</th>
                <th scope="col" class="px-6 py-3">Status</th>
                <th scope="col" class="px-6 py-3">Action</th>
              </tr>
            </thead>
            <tbody>
              <% users.forEach(user=> { %>
                <tr class=" odd:bg-zinc-800 even:bg-zinc-800/40">
                  <td class="px-6 py-4 font-medium whitespace-nowrap text-zinc-200">
                    <%= user.name %>
                  </td>
                  <td class="px-6 py-4">
                    <%= user.email %>
                  </td>
                  <td class="px-6 py-4 capitalize">
                    <%= user.isAdmin %>
                  </td>
                  <td class="px-6 py-4">
                    <% if(user.isActive) { %>
                      <span
                        class="bg-green-500/20 text-green-400 text-xs font-medium px-2.5 py-0.5 rounded">Active</span>
                      <% } else { %>
                        <span
                          class="bg-red-500/20 text-red-400 text-xs font-medium px-2.5 py-0.5 rounded">Inactive</span>
                        <% } %>
                  </td>
                  <td class="px-6 py-4">
                    <a href="/admin/user/<%= user._id %>" class="text-green-500 hover:underline">View</a>
                  </td>
                </tr>
                <% }) %>
            </tbody>
          </table>
        </div>
      </div>


      <!-- assets -->
      <div id="assets" class="section hidden opacity-0 scale-95 transition duration-300">
        <div class="">
            <div class="flex flex-wrap gap-4 sm:gap-8 md:gap-4 w-full px-4 ">
    <% items.slice().reverse().forEach(function(item) { %>
      
      <% if(item.isAd) { %>
        <!-- Premium Ad Card -->
        <a href="item/<%= item._id %>" target="_blank"
          class="w-full sm:w-[48%] md:w-[30%] lg:w-[22%] hover:scale-105 transition duration-300 flex flex-col rounded-2xl overflow-hidden shadow-xl relative bg-gradient-to-b from-gray-900/90 to-gray-800/80 backdrop-blur-sm border border-gray-700">

         

          <div class="aspect-video overflow-hidden">
            <img class="w-full h-full object-cover"
              src="data:image/jpeg;base64,<%= item.itemImage.toString('base64') %>" alt="">
          </div>

          <div class="flex flex-col pb-3 px-3 pt-2">
            <h1 class="text-base leading-5 font-semibold text-gray-100">
              <%= item.itemName %>
            </h1>
            <div class="flex justify-between items-center mt-2">
              <p class="text-xs text-gray-400">Sponsored Content</p>
            <span class="text-xs bg-green-900/50 border border-green-600 rounded-full px-2">Clicks : <%= item.clicks %></span>
            </div>
          </div>
        </a>

      <% } else if(item.itemPath) { %>
        <!-- Normal Item with custom path -->
        <a href="<%= item.itemPath %>/<%= item._id %>"
          class="w-full sm:w-[48%] md:w-[30%] lg:w-[22%] hover:scale-105 transition duration-300 flex flex-col">
          <div class="aspect-video rounded-lg overflow-hidden">
            <img class="w-full h-full object-cover"
              src="data:image/jpeg;base64,<%= item.itemImage.toString('base64') %>" alt="">
          </div>
          <div class="flex flex-col pb-2 px-1 pt-1">
            <h1 class="text-md leading-5 text-gray-300">
              <%= item.itemName %>
            </h1>
             <div class="flex justify-between items-center mt-2">
             
            <span class="text-xs bg-green-900/50 border border-green-600 rounded-full px-2">Clicks : <%= item.clicks %></span>
            </div>
          </div>
        </a>

      <% } else if(item.itemLink) { %>
        <!-- Normal Item with default link -->
        <a href="item/<%= item._id %>" target="_blank"
          class="w-full sm:w-[48%] md:w-[30%] lg:w-[22%] hover:scale-105 transition duration-300 flex flex-col">
          <div class="aspect-video rounded-lg overflow-hidden">
            <img class="w-full h-full object-cover"
              src="data:image/jpeg;base64,<%= item.itemImage.toString('base64') %>" alt="">
          </div>
          <div class="flex flex-col pb-2 px-1 pt-1">
            <h1 class="text-md leading-5 text-gray-300">
              <%= item.itemName %>
            </h1>
             <div class="flex justify-between items-center mt-2">
             
            <span class="text-xs bg-green-900/50 border border-green-600 rounded-full px-2">Clicks : <%= item.clicks %></span>
            </div>
          </div>
        </a>
      <% } %>

    <% }); %>
  </div>
        </div>
      </div>

      <!-- messages -->
      <div id="messages" class="section hidden opacity-0 scale-95 transition flex gap-4 duration-300">
         <% messages.forEach(message=> { %>
        <div class="bg-zinc-800 p-3 rounded-lg sm:w-80 hover:scale-102 transition duration-200">
          <div class="flex items-center gap-2">
            <div class="p-1 bg-green-800/50 rounded-lg">
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                stroke="currentColor" class="size-6">
                <path stroke-linecap="round" stroke-linejoin="round"
                  d="M15.75 6a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0ZM4.501 20.118a7.5 7.5 0 0 1 14.998 0A17.933 17.933 0 0 1 12 21.75c-2.676 0-5.216-.584-7.499-1.632Z" />
              </svg>

            </div>
            <div class="">
              <h1 class="leading-none"><%= message.name %></h1>
              <h1 class="text-sm leading-none text-zinc-500"><%= message.email %></h1>
            </div>
          </div>
            <p class="pt-2 pl-1/2 leading-none"><%= message.message %></p>
        </div>
        <% }) %>
      </div>
    </div>
  </div>

  <footer
    class="fixed md:hidden bottom-0 h-fit w-full flex justify-center items-center p-2 border-t border-zinc-600 bg-zinc-700 backdrop-blur-md z-50">
    <button onclick="showSection('Dashboard'); highlightButton(this)"
      class="hover:bg-zinc-800 px-3 py-2 rounded-md text-left text-xl transition duration-200">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"
        class="size-6">
        <path stroke-linecap="round" stroke-linejoin="round"
          d="M10.5 6h9.75M10.5 6a1.5 1.5 0 1 1-3 0m3 0a1.5 1.5 0 1 0-3 0M3.75 6H7.5m3 12h9.75m-9.75 0a1.5 1.5 0 0 1-3 0m3 0a1.5 1.5 0 0 0-3 0m-3.75 0H7.5m9-6h3.75m-3.75 0a1.5 1.5 0 0 1-3 0m3 0a1.5 1.5 0 0 0-3 0m-9.75 0h9.75" />
      </svg>
    </button>
    <button onclick="showSection('users'); highlightButton(this)"
      class="hover:bg-zinc-800 px-3 py-2 rounded-md text-left text-xl transition duration-200">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"
        class="size-6">
        <path stroke-linecap="round" stroke-linejoin="round"
          d="M15 19.128a9.38 9.38 0 0 0 2.625.372 9.337 9.337 0 0 0 4.121-.952 4.125 4.125 0 0 0-7.533-2.493M15 19.128v-.003c0-1.113-.285-2.16-.786-3.07M15 19.128v.106A12.318 12.318 0 0 1 8.624 21c-2.331 0-4.512-.645-6.374-1.766l-.001-.109a6.375 6.375 0 0 1 11.964-3.07M12 6.375a3.375 3.375 0 1 1-6.75 0 3.375 3.375 0 0 1 6.75 0Zm8.25 2.25a2.625 2.625 0 1 1-5.25 0 2.625 2.625 0 0 1 5.25 0Z" />
      </svg>
    </button>
    <button onclick="showSection('assets'); highlightButton(this)"
      class="hover:bg-zinc-800 px-3 py-2 rounded-md text-left text-xl transition duration-200">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"
        class="size-6">
        <path stroke-linecap="round" stroke-linejoin="round"
          d="M2.25 12.75V12A2.25 2.25 0 0 1 4.5 9.75h15A2.25 2.25 0 0 1 21.75 12v.75m-8.69-6.44-2.12-2.12a1.5 1.5 0 0 0-1.061-.44H4.5A2.25 2.25 0 0 0 2.25 6v12a2.25 2.25 0 0 0 2.25 2.25h15A2.25 2.25 0 0 0 21.75 18V9a2.25 2.25 0 0 0-2.25-2.25h-5.379a1.5 1.5 0 0 1-1.06-.44Z" />
      </svg>
    </button>
    <button onclick="showSection('messages'); highlightButton(this)"
      class="hover:bg-zinc-800 px-3 py-2 rounded-md text-left text-xl transition duration-200">
     <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
  <path stroke-linecap="round" stroke-linejoin="round" d="M7.5 8.25h9m-9 3H12m-9.75 1.51c0 1.6 1.123 2.994 2.707 3.227 1.129.166 2.27.293 3.423.379.35.026.67.21.865.501L12 21l2.755-4.133a1.14 1.14 0 0 1 .865-.501 48.172 48.172 0 0 0 3.423-.379c1.584-.233 2.707-1.626 2.707-3.228V6.741c0-1.602-1.123-2.995-2.707-3.228A48.394 48.394 0 0 0 12 3c-2.392 0-4.744.175-7.043.513C3.373 3.746 2.25 5.14 2.25 6.741v6.018Z" />
</svg>
    </button>
  </footer>

  <script src="/socket.io/socket.io.js"></script>
  <script>
    const socket = io();
    const activeUserEl = document.getElementById('activeUserCount');

    const ctx = document.getElementById('activeUsersChart').getContext('2d');
    const activeUsersChart = new Chart(ctx, {
      type: 'line',
      data: {
        labels: [],
        datasets: [{
          label: 'Live Users',
          data: [],
          borderColor: '#22c55e',
          backgroundColor: 'rgba(34, 197, 94, 0.2)',
          tension: 0.4,
          pointRadius: 2
        }]
      },
      options: {
        animation: false,
        responsive: true,
        plugins: {
          legend: { labels: { color: 'white' } }
        },
        scales: {
          x: {
            ticks: { color: 'white' },
            grid: { color: 'rgba(255,255,255,0.1)' }
          },
          y: {
            beginAtZero: true,
            ticks: { color: 'white' },
            grid: { color: 'rgba(255,255,255,0.1)' }
          }
        }
      }
    });

    socket.on('updateActiveUsers', function (count) {
      const now = new Date().toLocaleTimeString();
      if (activeUserEl) activeUserEl.innerText = count;

      if (activeUsersChart.data.labels.length >= 20) {
        activeUsersChart.data.labels.shift();
        activeUsersChart.data.datasets[0].data.shift();
      }

      activeUsersChart.data.labels.push(now);
      activeUsersChart.data.datasets[0].data.push(count);
      activeUsersChart.update();
    });

    // Section display logic
    function showSection(id) {
      document.querySelectorAll('.section').forEach(section => {
        section.classList.add('hidden');
        section.classList.remove('opacity-100', 'scale-100');
        section.classList.add('opacity-0', 'scale-95');
      });

      const sectionToShow = document.getElementById(id);
      if (sectionToShow) {
        sectionToShow.classList.remove('hidden');

        // Trigger reflow to restart animation
        void sectionToShow.offsetWidth;

        sectionToShow.classList.remove('opacity-0', 'scale-95');
        sectionToShow.classList.add('opacity-100', 'scale-100');
      }
    }


    // Load Dashboard by default
    window.addEventListener('DOMContentLoaded', () => {
      showSection('Dashboard');

    });


    function highlightButton(activeBtn) {
      document.querySelectorAll('button').forEach(btn => {
        btn.classList.remove('bg-zinc-600');
      });
      activeBtn.classList.add('bg-zinc-600');
    }


  </script>

</body>

</html>